(function(a){var b={menuFields:['menu-item-url','menu-item-title','menu-item-attr-title','menu-item-target','menu-item-classes','menu-item-xfn','menu-item-description','menu-item-featured-style','menu-item-featured-text','menu-item-icon','menu-submenu-width','menu-submenu-custom-width','menu-submenu-position','menu-submenu-transition'],menuSelectFieldDefault:{'menu-item-featured-style':'','menu-submenu-width':'auto','menu-submenu-position':'left','menu-submenu-transition':''},isSavingMenu:!1,init:function(){this.initXMenuData(),this.loadTemplates()},initXMenuData:function(){var c,d,f;for(f in xmenu_meta.data)for(xmenu_meta.data[f].is_changed=!1,c=0;c<b.menuFields.length;c++)d=b.menuFields[c],'undefined'==typeof xmenu_meta.data[f][d]&&(d in b.menuSelectFieldDefault?xmenu_meta.data[f][d]=b.menuSelectFieldDefault[d]:xmenu_meta.data[f][d]='')},loadTemplates:function(){a.ajax({url:xmenu_meta.ajax_url,data:{action:'xmenu_get_xmenu_panel'},success:function(c){0==a('#xmenu_panel').length&&a('body').append('<div id="xmenu_panel"></div>'),a('#xmenu_panel').html(c),b.installListener(),b.initXMenuButton()}})},installListener:function(){var c=this,d=a('.xmenu-panel-wrapper'),f=d.find('.xmenu-button-close'),g=d.find('.xmenu-sections'),h=d.find('.xmenu-tabs li'),j=d.find('[name="menu-item-featured-style"]'),k=d.find('[name="menu-item-featured-text"]'),l=d.find('#xmenu_submenu_width'),m=d.find('#xmenu_submenu_custom_width'),n=d.find('.xmenu-icon-wrapper'),o=d.find('.xmenu-icon-remove'),p=d.find('.xmenu-buttons');g.perfectScrollbar({wheelSpeed:0.5,suppressScrollX:!0}),h.on('click',function(){var s=a(this).data('section');h.removeClass('active'),a(this).addClass('active'),g.find('.xmenu-section-item').removeClass('active'),g.find('#'+s).addClass('active'),g.perfectScrollbar('update')}),j.on('change',function(){var s=a(this).val();''==s?k.parent().hide():k.parent().show()}),l.on('change',function(){var s=a(this).val();'custom'===s?m.parent().show():m.parent().hide()}),n.on('click',function(s){if(!(0<a(s.target).closest('.xmenu-icon-remove').length)){var t=n.find('[name="menu-item-icon"]');GSF_ICON_POPUP.open(t.val(),function(u){c.setIcon(u),t.trigger('change')})}}),o.on('click',function(){b.setIcon('')}),f.on('click',function(){d.removeClass('in')}),this.windowKeyUp(),this.saveMenu(),this.saveAllMenu(),this.eventChangedForXmenuField()},saveMenu:function(){var c=a('.xmenu-panel-wrapper'),d=c.find('.xmenu-buttons');d.find('.xmenu-button-save').on('click',function(){var f=a('.xmenu-panel-wrapper').data('menu-id');'undefined'==typeof f||null===f||b.saveMenuItems([f])})},saveAllMenu:function(){var c=a('.xmenu-panel-wrapper'),d=c.find('.xmenu-buttons');d.find(' > span').on('click',function(){d.find('.xmenu-save-all').fadeToggle()}),a('body').on('click',function(f){a(f.target).closest('.xmenu-buttons > span').length||a('.xmenu-save-all').fadeOut()}),d.find('.xmenu-save-all').on('click',function(){var g,f=[],h=0;for(g in xmenu_meta.data)xmenu_meta.data[g].is_changed&&(f[h++]=parseInt(g.replace('menu_',''),10));b.saveMenuItems(f)})},eventChangedForXmenuField:function(){var d,f,c=a('.xmenu-panel-wrapper');for(d=0;d<b.menuFields.length;d++)f=b.menuFields[d],c.find('[name="'+f+'"]').on('change',function(){var g=a(this),h=c.data('menu-id'),j=g.attr('name');xmenu_meta.data['menu_'+h].is_changed=!0,a('#menu-item-'+h).find('.xmenu-item-config').addClass('is-changed'),xmenu_meta.data['menu_'+h][j]='menu-item-target'===j?g.prop('checked')?g.val():'':g.val();var k=a('#menu-item-'+h).find('[name="'+j+'['+h+']"]');'menu-item-target'===j?k.prop('checked',g.prop('checked')):k.val(g.val()),k.trigger('change')})},initXMenuButton:function(){a('ul.menu > li.menu-item').each(function(){var c=parseInt(a(this).attr('id').replace('menu-item-',''),10);a('> .menu-item-bar > .menu-item-handle > span.item-title',this).append('<span class="xmenu-item-config" data-id="'+c+'"><i class="fa fa-cogs"></i> XMENU <i class="fa fa-warning"></i></span>')}),a('ul.menu > li.menu-item .xmenu-item-config').on('click',function(){var c=parseInt(a(this).attr('data-id'),10);b.openXMenuPanel(c)})},openXMenuPanel:function(c){var d=a('.xmenu-panel-wrapper');if(!d.hasClass('.xmenu-is-saving')){d.data('menu-id',c),d.addClass('in');var o,p,q,f=a('.xmenu-panel-wrapper'),g=f.find('.xmenu-icon-wrapper'),h=g.find('.xmenu-icon > div > i'),j=f.find('#xmenu_item_url'),k=f.find('[name="menu-item-featured-style"]'),l=f.find('[name="menu-item-featured-text"]'),m=f.find('.xmenu-title'),n=f.find('#xmenu_submenu_width');for(m.text(xmenu_meta.data['menu_'+c]['menu-item-title']),'custom'===xmenu_meta.data['menu_'+c].type?j.removeAttr('readonly'):j.attr('readonly','readonly'),q=0;q<b.menuFields.length;q++)p=b.menuFields[q],o=f.find('[name="'+p+'"]'),'menu-item-target'===p?o.prop('checked','_blank'===xmenu_meta.data['menu_'+c][p]):o.val(xmenu_meta.data['menu_'+c][p]),'menu-item-icon'===p&&(h.attr('class',xmenu_meta.data['menu_'+c][p]),''===xmenu_meta.data['menu_'+c][p]?g.removeClass('has-icon'):g.addClass('has-icon'));''===k.val()?l.parent().hide():l.parent().show(),n.trigger('change')}},setIcon:function(c){var d=a('.xmenu-icon-wrapper'),f=d.find('[name="menu-item-icon"]'),g=d.find('.xmenu-icon > div > i');f.val(c),g.attr('class',c),''==c?d.removeClass('has-icon'):d.addClass('has-icon'),f.trigger('change')},windowKeyUp:function(){a(window).on('keyup',function(c){var d=c.keyCode?c.keyCode:c.which;if(27==d){var f=a('.xmenu-panel-wrapper');if(f.hasClass('in'))f.removeClass('in');else{var g=f.data('menu-id');'undefined'!=typeof g&&f.addClass('in')}a('.xmenu-icon-popup').fadeOut(),a('.xmenu-save-all').fadeOut()}})},saveMenuItems:function(c){if(!b.isSavingMenu){b.isSavingMenu=!0;var h,d=a('.xmenu-button-save'),f=[],g=c.length;for(d.find('span').text(d.data('saving')),d.find('i').addClass('fa-spin fa-spinner'),h=0;h<g;h++)f[h]={menu_id:c[h],data:xmenu_meta.data['menu_'+c[h]]};a.ajax({url:xmenu_meta.ajax_url,type:'POST',data:{action:'xmenu_save_menu',data:f,nonce:a('#xmenu_nonce').val()},success:function(){for(b.isSavingMenu=!1,d.find('span').text(d.data('save')),d.find('i').removeClass('fa-spin fa-spinner'),h=0;h<g;h++)xmenu_meta.data['menu_'+c[h]].is_changed=!1,a('#menu-item-'+c[h]).find('.xmenu-item-config').removeClass('is-changed')},error:function(){b.isSavingMenu=!1,d.find('span').text(d.data('save')),d.find('i').removeClass('fa-spin fa-spinner')}})}}};a(document).ready(function(){b.init()})})(jQuery);