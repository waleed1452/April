(function(a){'use strict';var b={wrapper:[],demoItem:[],tryInstallCount:0,isInstallSettingDone:!0,initialize:function(){b.wrapper=a('.g5plus-demo-data-wrapper'),this.demoClick()},demoClick:function(){a('.install-button',b.wrapper).on('click',function(){var c=a(this).attr('id');if(!b.wrapper.hasClass('setting-up')){if('fix_data'==c){if(!confirm('Are you sure fix demo data error?'))return;}else if('install_demo'==c){if('install'!=prompt('Type "install" to accept install demo data. \nNOTE: Will delete all post, page before install!',''))return;if(!confirm('Are you sure install demo data?\nNOTE: Will delete all post, page before install!'))return}else if('install'!=prompt('Type "install" to accept install setting data.',''))return;b.wrapper.addClass('setting-up'),b.demoItem=a(this).closest('.g5plus-demo-site'),0<b.demoItem.length&&b.demoItem.addClass('in'),a(this).addClass('in');var d=a(this).attr('data-demo'),f=a(this).attr('data-path');window.onbeforeunload=function(g){g||(g=window.event),g.cancelBubble=!0,g.returnValue='The install demo you made will be lost if you navigate away from this page.',g.stopPropagation&&(g.stopPropagation(),g.preventDefault())},'fix_data'==c?(b.isInstallSettingDone=!1,b.importSettingProgressBar(0),b.import('fix-data',d,f,'')):'install_demo'==c?(b.setProgressBar('init',0,0),b.import('init',d,f,'')):(b.isInstallSettingDone=!1,b.importSettingProgressBar(0),b.import('import-setting',d,f,''))}}),a('.fix-button',b.wrapper).on('click',function(){if(confirm('Are you sure fix demo data error?')){var c=a(this).attr('data-demo'),d=a(this).attr('data-path');G5Plus_Install_DemoData.install('fix-data','livesite',c,d,'')}})},importSettingProgressBar:function(c){b.isInstallSettingDone||(a('.progress-bar > span',this.wrapper).css('width',c+'%'),setTimeout(function(){60>c?c+=1:80>c?c+=0.5:99>c&&(c+=0.25),b.importSettingProgressBar(c)},1e3))},setProgressBar:function(c,d,f){var g=0;g='init'===c?0:'setting'===c?5:'core'===c?5+80*(1*d/f):'slider'===c?85+10*(1*d/f):'update-id'===c?95:'done'===c?100:100;a('.progress-bar > span',this.wrapper).css('width',g+'%')},import:function(c,d,f,g){a.ajax({type:'POST',data:{type:c,demo_site:d,demo_path:f,other_data:g,action:'g5plus_install_demo',security:!0},url:gsf_install_demo_meta.ajax_url,success:function(i){b.tryInstallCount=0;try{switch(i=a.parseJSON(i),i.code){case'error':case'fileNotFound':a('.install-message',b.wrapper).addClass('error'),a('.install-message',b.wrapper).text(i.message),b.isInstallSettingDone=!0;break;case'setting':case'core':case'slider':case'update-id':var j=0,k=1;'undefined'!=typeof i.message&&'undefined'!=typeof i.message.count&&(j=i.message.count),'undefined'!=typeof i.message&&'undefined'!=typeof i.message.amount&&(k=i.message.amount),b.setProgressBar(i.code,j,k),b.import(i.code,d,f,i.message);break;case'done':b.isInstallSettingDone=!0,b.setProgressBar(i.code,1,1),a('.progress-bar',this.wrapper).addClass('nostripes'),b.wrapper.addClass('done'),a('.install-message',b.wrapper).addClass('updated'),a('.install-message',b.wrapper).text(a('.install-message',b.wrapper).attr('data-success')),a('.install-button > i',b.wrapper).attr('class','fa fa-check'),window.onbeforeunload=null;}}catch(l){if('import-setting'==c||'fix-data'==c)return b.isInstallSettingDone=!0,a('.install-message',b.wrapper).addClass('error'),a('.install-message',b.wrapper).text('Install demo data error!'),void(window.onbeforeunload=null);if(10<b.tryInstallCount)return a('.install-message',b.wrapper).addClass('error'),a('.install-message',b.wrapper).text('Install demo data error!'),void(window.onbeforeunload=null);b.tryInstallCount+=1,b.import(c,d,f)}},error:function(){return'import-setting'==c||'fix-data'==c?(b.isInstallSettingDone=!0,a('.install-message',b.wrapper).addClass('error'),a('.install-message',b.wrapper).text('Install demo data error!'),void(window.onbeforeunload=null)):10<b.tryInstallCount?(a('.install-message',b.wrapper).addClass('error'),a('.install-message',b.wrapper).text('Install demo data error!'),void(window.onbeforeunload=null)):void(b.tryInstallCount+=1,b.import(c,d,f))}})}};a(document).ready(function(){b.initialize()})})(jQuery);