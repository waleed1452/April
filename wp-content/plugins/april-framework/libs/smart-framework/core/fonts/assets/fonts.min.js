var GSF_Fonts=GSF_Fonts||{};!function(t){"use strict";GSF_Fonts={_loadFontCount:0,_fonts:{},_isSubmitting:!1,init:function(){this.tabClick(),this.binderFonts(),this.searchFonts(),this.events()},events:function(){t(".gsf-reset-active-fonts").on("click",function(n){if(n.preventDefault(),confirm(GSF_META_DATA.msgConfirmResetFont)&&!GSF_Fonts._isSubmitting){GSF_Fonts._isSubmitting=!0;var i=t(this);i.find("i").addClass("fa-spin fa-spinner"),t.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_reset_active_font",_nonce:GSF_META_DATA.nonce},type:"post",success:function(t){i.find("i").removeClass("fa-spin fa-spinner"),GSF_Fonts._isSubmitting=!1,t.success?GSF_Fonts.bindActiveFont():alert(t.data)},error:function(){i.find("i").removeClass("fa-spin fa-spinner"),GSF_Fonts._isSubmitting=!1}})}})},binderFonts:function(){var t=["google","standard","custom"];for(var n in t)this.bindFonts(t[n]);this.bindActiveFont()},getFontFamily:function(t){return-1!=t.indexOf(",")?t:-1!=t.indexOf(" ")?"'"+t+"'":t},enqueueFont:function(n){var i="";switch(n.kind){case"webfonts#webfont":i="https://fonts.googleapis.com/css?family="+n.family.replace(" ","+")+":100,200,300,400,500,600,700,800,900,1000";break;case"custom":i=void 0!==n.css_url?n.css_url:GSF_META_DATA.font_url+n.css_file}""!==i&&t("body").append('<link class="gsf-preview-css-font" rel="stylesheet" href="'+i+'" type="text/css" media="all" />')},bindFonts:function(n,i){null==i&&(i=!1);t(".gsf-fonts-wrapper").data("nonce");t.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_get_font_list",_nonce:GSF_META_DATA.nonce,font_type:n},type:"get",success:function(s){if(s.success){GSF_Fonts._fonts[s.data.font_type]=s.data.fonts.items;var e;switch(s.data.font_type){case"google":e=wp.template("gsf-google-fonts");break;case"standard":e=wp.template("gsf-standard-fonts");break;case"custom":e=wp.template("gsf-custom-fonts")}if(e){var o=t(".gsf-font-listing-inner"),a=t(e(s.data));t("#"+n+"_fonts").remove(),o.append(a),GSF_Fonts.addEventListener(a),a.find(".gsf-font-categories li a").first().trigger("click"),i&&a.show()}GSF_Fonts._loadFontCount++}},error:function(){GSF_Fonts._loadFontCount++}})},addEventListener:function(n){n.find("form").ajaxForm({beforeSubmit:function(){if(GSF_Fonts._isSubmitting)return!1;n.find("form").find("button i").addClass("fa-spin fa-spinner"),GSF_Fonts._isSubmitting=!0},success:function(i){n.find("form").find("button i").removeClass("fa-spin fa-spinner"),GSF_Fonts._isSubmitting=!1,i.success?(GSF_Fonts.bindFonts("custom",!0),t("#gsf-custom-font-popup").find(".mfp-close").trigger("click")):alert(i.data)}}),n.find(".gsf-font-categories li a").on("click",function(){var i=t(this),s=i.parent().data("ref");n.find(".gsf-font-categories li").removeClass("active"),i.parent().addClass("active"),GSF_Fonts.filterFontsByCate(n,s),t("#search_fonts").val("")}),n.find(".gsf-add-custom-font button").on("click",function(){t.magnificPopup.open({items:{src:"#gsf-custom-font-popup",type:"inline"},mainClass:"mfp-move-horizontal",callbacks:{open:function(){this.content.find("form")[0].reset()}},openDelay:0,removalDelay:100,midClick:!0})}),n.find(".gsf-font-item-action-delete").on("click",function(n){if(n.preventDefault(),confirm(GSF_META_DATA.msgConfirmDeleteCustomFont)&&!GSF_Fonts._isSubmitting){GSF_Fonts._isSubmitting=!0;var i=t(this),s=i.closest(".gsf-font-item").data("name");i.find("i").addClass("fa-spin fa-spinner"),t.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_delete_custom_font",_nonce:GSF_META_DATA.nonce,family_name:s},type:"post",success:function(t){i.find("i").removeClass("fa-spin fa-spinner"),GSF_Fonts._isSubmitting=!1,t.success?GSF_Fonts.bindFonts("custom",!0):alert(t.data)},error:function(){i.find("i").removeClass("fa-spin fa-spinner"),GSF_Fonts._isSubmitting=!1}})}}),n.find(".gsf-font-item-action-add").on("click",function(n){n.preventDefault();var i=t(this),s=i.data("type"),e=i.closest(".gsf-font-item").data("name"),o=GSF_Fonts.findFontSource(GSF_Fonts._fonts[s],e);if(null!=o&&!i.find("i").hasClass("fa-check")){if(GSF_Fonts._isSubmitting)return!0;GSF_Fonts._isSubmitting=!0,i.find("i").addClass("fa-spin fa-spinner"),t.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_using_font",_nonce:GSF_META_DATA.nonce,font_data:o},type:"post",success:function(t){GSF_Fonts._isSubmitting=!1,i.find("i").removeClass("fa-spin fa-spinner"),t.success?(i.find("i").attr("class","fa fa-check"),GSF_Fonts.bindActiveFont()):alert(t.data)},error:function(){GSF_Fonts._isSubmitting=!1,i.find("i").removeClass("fa-spin fa-spinner")}})}})},bindActiveFont:function(){t(".gsf-fonts-wrapper").data("nonce");t.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_get_font_list",_nonce:GSF_META_DATA.nonce,font_type:"active"},type:"get",success:function(n){if(n.success){GSF_Fonts._fonts[n.data.font_type]=n.data.fonts.items;var i=wp.template("gsf-active-fonts");if(i){var s=t(".gsf-font-active-listing"),e=t(i(n.data));t("#active_fonts").remove(),s.append(e),GSF_Fonts.activeFontAddEventListener(e),t(".gsf-preview-css-font").remove();for(var o in n.data.fonts.items)GSF_Fonts.enqueueFont(n.data.fonts.items[o])}}},error:function(){}})},activeFontAddEventListener:function(n){n.find(".gsf-font-active-item-header").on("click",function(n){t(n.target).closest(".gsf-font-active-item-remove").length||(t(this).toggleClass("in"),t(this).next(".gsf-font-active-content").slideToggle())}),n.find(".gsf-font-active-item-remove").on("click",function(n){if(n.preventDefault(),confirm(GSF_META_DATA.msgConfirmRemoveActiveFont)){var i=t(this),s=i.closest(".gsf-font-active-item").data("name");if(GSF_Fonts._isSubmitting)return!0;GSF_Fonts._isSubmitting=!0,i.find("i").addClass("fa-spin fa-spinner"),t.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_remove_active_font",_nonce:GSF_META_DATA.nonce,family_name:s},type:"post",success:function(n){GSF_Fonts._isSubmitting=!1,i.find("i").removeClass("fa-spin fa-spinner"),n.success?(t('.gsf-font-item[data-name="'+n.data.family+'"]').find(".gsf-font-item-action-add i").attr("class","fa fa-plus"),GSF_Fonts.bindActiveFont()):alert(n.data)},error:function(){GSF_Fonts._isSubmitting=!1,i.find("i").removeClass("fa-spin fa-spinner")}})}}),n.find("form").ajaxForm({beforeSubmit:function(){if(GSF_Fonts._isSubmitting)return!1;n.find("form").find("button i").addClass("fa-spin fa-spinner"),GSF_Fonts._isSubmitting=!0},success:function(t){n.find("form").find("button i").removeClass("fa-spin fa-spinner"),GSF_Fonts._isSubmitting=!1,t.success||alert(t.data)}})},findFontSource:function(t,n){for(var i in t)if(t[i].family==n)return t[i];return null},filterFontsByCate:function(n,i){n.find(".gsf-font-item").each(function(){var n=t(this);n.data("category")!==i?n.hide():n.show()})},filterFontByKeyWord:function(n,i){n.find(".gsf-font-item").each(function(){var n=t(this),s=n.find(".gsf-font-item-name").text();try{s.search(new RegExp(i,"i"))<0?n.hide():n.show()}catch(t){}})},searchFonts:function(){t("#search_fonts").on("keyup",function(n){var i=t(".gsf-font-container:visible"),s=t(this).val();i.find(".gsf-font-categories li").removeClass("active"),GSF_Fonts.filterFontByKeyWord(i,s)})},tabClick:function(){t(".gsf-font-type > li > a").on("click",function(n){if(n.preventDefault(),!(GSF_Fonts._loadFontCount<3)){var i=t(this);if(!i.parent().hasClass("active")){var s=t(this).data("ref");t(".gsf-font-type > li").removeClass("active"),i.parent().addClass("active"),t(".gsf-font-container").each(function(){var n=t(this);n.data("ref")!=s&&n.slideUp()}),t("#"+s+"_fonts").slideDown(function(){t("#"+s+"_fonts").find(".gsf-font-categories li a").length?t("#"+s+"_fonts").find(".gsf-font-categories li a").first().trigger("click"):(t("#search_fonts").val(""),t("#search_fonts").trigger("keyup"))})}}})}},t(document).ready(function(){GSF_Fonts.init()})}(jQuery);