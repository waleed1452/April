var GSF_THEME_OPTION;!function(e){"use strict";GSF_THEME_OPTION={_isSavingData:!1,init:function(){this.headerSize(),this.affixHeader(),this.backupListener(),this.checkFieldChange(),this.saveOptions(),this.resetOptions(),this.resetSection(),this.windowResize(),this.sectionClickedEvent(),this.presetProcess(),this.optionMessage(),this.deletePreset()},optionMessage:function(){var t=e('<div class="gsf-theme-options-message gsf-warning">'+GSF_META_DATA.msgSaveWarning+"</div>"),s=e('<div class="gsf-theme-options-message gsf-success">'+GSF_META_DATA.msgSaveSuccess+"</div>");0==e(".gsf-theme-options-preset").length?e(".gsf-theme-options-action-inner").prepend(t).prepend(s):e(".gsf-meta-box-fields").prepend(t).prepend(s)},headerSize:function(){var t=e(".gsf-theme-options-action-wrapper");t.find(".gsf-theme-options-action-inner").outerWidth(t.width())},affixHeader:function(){e(window).scroll(function(){var t=e(".gsf-theme-options-action-wrapper");e(window).scrollTop()>t.offset().top-32?t.addClass("gsf-affix"):t.removeClass("gsf-affix")})},windowResize:function(){e(window).resize(function(){GSF_THEME_OPTION.affixHeader(),GSF_THEME_OPTION.headerSize()})},sectionClickedEvent:function(){e(document).on("gsf_section_changed",function(){GSF_THEME_OPTION.affixHeader(),GSF_THEME_OPTION.headerSize()})},backupListener:function(){e(document).on("click",".gsf-theme-options-import",function(){var t=e("#_current_page").val(),s=e("#_current_preset").val();e.magnificPopup.open({items:{src:GSF_META_DATA.ajaxUrl+"?action=gsf_import_popup&_current_page="+t+"&_current_preset="+s,type:"ajax"},mainClass:"mfp-move-horizontal",callbacks:{ajaxContentAdded:function(){GSF_THEME_OPTION.importData(this.content),GSF_THEME_OPTION.exportData(this.content)}},openDelay:0,removalDelay:200,midClick:!0})})},importData:function(t){t.find(".gsf-theme-options-backup-import button").on("click",function(){var t=e(this),s=t.parent().find("textarea").val();if(""!=s&&confirm(GSF_META_DATA.msgConfirmImportData)&&!t.data("importing")){var n=e("#_wpnonce").val(),i=e("#_current_page").val(),o=e("#_current_preset").val();t.data("importing",!0),t.html('<i class="fa fa-spin fa-spinner"></i> '+t.data("importing-text")),e.ajax({url:GSF_META_DATA.ajaxUrl,data:{_wpnonce:n,_current_page:i,_current_preset:o,action:"gsf_import_theme_options",backup_data:s},type:"post",success:function(e){t.data("importing",!1),t.html(t.data("import-text")),1==e?(alert(GSF_META_DATA.msgImportDone),window.location.reload()):alert(GSF_META_DATA.msgImportError)}})}})},exportData:function(t){t.find(".gsf-theme-options-backup-export button").on("click",function(){var t=e("#_wpnonce").val(),s=e("#_current_page").val(),n=e("#_current_preset").val();window.open(GSF_META_DATA.ajaxUrl+"?action=gsf_export_theme_options&_wpnonce="+t+"&_current_page="+s+"&_current_preset="+n,"_blank")})},checkFieldChange:function(){e(document).on("gsf_field_change",".gsf-field",function(){var t=e(".gsf-theme-options-message.gsf-warning"),s=e(".gsf-theme-options-message.gsf-success");s.is(":visible")?s.slideUp(function(){t.is(":visible")||t.slideDown()}):t.is(":visible")||t.slideDown(),window.onbeforeunload=GSF_THEME_OPTION.confirmWhenPageExit})},confirmWhenPageExit:function(e){e||(e=window.event),e.cancelBubble=!0,e.returnValue="",e.stopPropagation&&(e.stopPropagation(),e.preventDefault())},resetSection:function(){e(document).on("click",".gsf-theme-options-reset-section",function(){if(!GSF_THEME_OPTION._isSavingData&&confirm(GSF_META_DATA.msgConfirmResetSection)){e(this);var t=e("#_wpnonce").val(),s=e("#_current_page").val(),n=e("#_current_preset").val(),i=e(".gsf-sections").find("li.active").data("id");GSF_THEME_OPTION.showLoading("reset_section"),e.ajax({url:GSF_META_DATA.ajaxUrl,data:{_wpnonce:t,_current_page:s,_current_preset:n,action:"gsf_reset_section_options",section:i},type:"post",success:function(e){GSF_THEME_OPTION.hideLoading("reset_section"),1==e?(alert(GSF_META_DATA.msgResetSectionDone),window.location.reload()):alert(GSF_META_DATA.msgResetSectionError)}})}})},resetOptions:function(){e(document).on("click",".gsf-theme-options-reset-options",function(){if(!GSF_THEME_OPTION._isSavingData&&confirm(GSF_META_DATA.msgConfirmResetOptions)){e(this);var t=e("#_wpnonce").val(),s=e("#_current_page").val(),n=e("#_current_preset").val();GSF_THEME_OPTION.showLoading("reset_option"),e.ajax({url:GSF_META_DATA.ajaxUrl,data:{_wpnonce:t,_current_page:s,_current_preset:n,action:"gsf_reset_theme_options"},type:"post",success:function(e){GSF_THEME_OPTION.hideLoading("reset_option"),1==e?(alert(GSF_META_DATA.msgResetOptionsDone),window.location.reload()):alert(GSF_META_DATA.msgResetOptionsError)}})}})},saveOptions:function(){e(window).bind("keydown",function(t){if((t.ctrlKey||t.metaKey)&&"s"===String.fromCharCode(t.which).toLowerCase())return t.preventDefault(),e(".gsf-theme-options-save-options",".gsf-theme-options-page").trigger("click"),!1}),e(".gsf-theme-options-form").ajaxForm({beforeSubmit:function(){if(GSF_THEME_OPTION._isSavingData)return!1;GSF_THEME_OPTION.showLoading("save")},success:function(t){if(window.onbeforeunload=null,GSF_THEME_OPTION.hideLoading("save"),t.success){var s=e(".gsf-theme-options-message.gsf-warning"),n=e(".gsf-theme-options-message.gsf-success");s.is(":visible")?s.slideUp(function(){n.slideDown()}):n.slideDown()}}})},deletePreset:function(){e(document).on("click",".gsf-preset-action-delete",function(){if(!GSF_THEME_OPTION._isSavingData&&confirm(GSF_META_DATA.msgConfirmDeletePreset)){e(this);var t=e("#_wpnonce").val(),s=e("#_current_page").val(),n=e("#_current_preset").val();GSF_THEME_OPTION.showLoading("delete_preset"),e.ajax({url:GSF_META_DATA.ajaxUrl,data:{_wpnonce:t,_current_page:s,_current_preset:n,action:"gsf_delete_preset"},type:"post",success:function(t){GSF_THEME_OPTION.hideLoading("delete_preset"),1==t?e(".gsf-theme-options-preset-select li").first().trigger("click"):alert(GSF_META_DATA.msgDeletePresetError)}})}})},showLoading:function(t){var s;switch(e(".gsf-meta-box-wrap").addClass("in"),GSF_THEME_OPTION._isSavingData=!0,t){case"save":(s=e(".gsf-theme-options-save-options")).data("button-text",s.html()),s.html('<i class="fa fa-spin fa-spinner"></i> '+GSF_META_DATA.msgSavingOptions);break;case"reset_option":(s=e(".gsf-theme-options-reset-options")).data("button-text",s.html()),s.html('<i class="fa fa-spin fa-spinner"></i> '+GSF_META_DATA.msgResettingOptions);break;case"reset_section":(s=e(".gsf-theme-options-reset-section")).data("button-text",s.html()),s.html('<i class="fa fa-spin fa-spinner"></i> '+GSF_META_DATA.msgResettingSection);break;case"delete_preset":(s=e(".gsf-preset-action-delete")).data("button-text",s.html()),s.html('<i class="fa fa-spin fa-spinner"></i> '+GSF_META_DATA.msgDeletingPreset)}},hideLoading:function(t){var s;switch(e(".gsf-meta-box-wrap").removeClass("in"),GSF_THEME_OPTION._isSavingData=!1,t){case"save":(s=e(".gsf-theme-options-save-options")).html(s.data("button-text"));break;case"reset_option":(s=e(".gsf-theme-options-reset-options")).html(s.data("button-text"));break;case"reset_section":(s=e(".gsf-theme-options-reset-section")).html(s.data("button-text"));break;case"reset_section":(s=e(".gsf-preset-action-delete")).html(s.data("button-text"))}},presetProcess:function(){e(document).on("click",function(t){0==e(t.target).closest(".gsf-theme-options-preset-select").length&&e(".gsf-theme-options-preset-select").removeClass("in")}),e(document).on("click",".gsf-theme-options-preset-create",function(){e.magnificPopup.open({items:{src:"#gsf_options_preset_popup",type:"inline"},mainClass:"mfp-move-horizontal",callbacks:{open:function(){var t=e(".gsf-theme-options-preset-popup-content input");t.val(""),setTimeout(function(){t.focus()},200)}},openDelay:0,removalDelay:100,midClick:!0})}),e(document).on("click",".gsf-theme-options-preset-select",function(){e(this).toggleClass("in")}),e(".gsf-theme-options-preset-popup-content button").on("click",function(){var t=e(".gsf-theme-options-preset-popup-content input").val();if(""!=t){var s=e(this);if(s.hasClass("gsf-preset-creating"))return;s.addClass("gsf-preset-creating");var n=e("#_wpnonce").val(),i=e("#_current_page").val(),o=e("#_current_preset").val();e(".gsf-theme-options-preset-popup-content button i").addClass("fa-spin fa-spinner"),e.ajax({url:GSF_META_DATA.ajaxUrl,data:{_wpnonce:n,_current_page:i,_current_preset:o,_preset_title:t,action:"gsf_create_preset_options"},type:"post",success:function(t){e(".gsf-theme-options-preset-popup-content button i").removeClass("fa-spin fa-spinner"),s.removeClass("gsf-preset-creating"),e(".gsf-theme-options-preset-popup").find(".mfp-close").trigger("click");var n=e(t);e(".gsf-theme-options-page").html(n),n.find(".gsf-meta-box-wrap").each(function(){GSF.fields.initFields(e(this))}),GSF_THEME_OPTION.saveOptions(),GSF_THEME_OPTION.headerSize(),GSF_THEME_OPTION.optionMessage(),e(document).trigger("gsf_section_changed"),e(".gsf-field").trigger("gsf_check_required"),e(".gsf-field").trigger("gsf_check_preset"),o=e("#_current_preset").val(),GSF_THEME_OPTION.changeLocation(o)},error:function(){e(".gsf-theme-options-preset-popup-content button i").removeClass("fa-spin fa-spinner"),s.removeClass("gsf-preset-creating")}})}}),e(document).on("click",".gsf-theme-options-preset-select li",function(){if(!e(".gsf-theme-options-message.gsf-warning").is(":visible")||confirm(GSF_META_DATA.msgPreventChangeData)){var t=e(this);if(!t.hasClass("gsf-preset-creating")){var s=e("#_current_preset").val(),n=t.data("preset");s!=n&&(t.addClass("gsf-preset-creating"),e(".gsf-theme-options-page").addClass("in"),GSF_THEME_OPTION.getPresetOptions(n,t))}}})},getPresetOptions:function(t,s){var n=e("#_current_page").val();e.ajax({url:GSF_META_DATA.ajaxUrl,data:{_current_page:n,_current_preset:t,action:"gsf_ajax_theme_options"},type:"post",success:function(n){window.onbeforeunload=null,null!=s&&s.removeClass("gsf-preset-creating"),e(".gsf-theme-options-page").removeClass("in"),e(".gsf-theme-options-preset-popup").find(".mfp-close").trigger("click");var i=e(n);e(".gsf-theme-options-page").html(i),i.find(".gsf-meta-box-wrap").each(function(){GSF.fields.initFields(e(this))}),GSF_THEME_OPTION.headerSize(),GSF_THEME_OPTION.saveOptions(),GSF_THEME_OPTION.optionMessage(),e(document).trigger("gsf_section_changed"),e(".gsf-field").trigger("gsf_check_required"),GSF_THEME_OPTION.changeLocation(t)},error:function(){null!=s&&s.removeClass("gsf-preset-creating"),e(".gsf-theme-options-page").removeClass("in")}})},changeLocation:function(e){var t=window.location.href;""==e?t=t.replace(/(&_gsf_preset=)([^&]*)/g,function(e,t,s){return""}):t.match(/(&_gsf_preset=)([^&]*)/g)?t=t.replace(/(&_gsf_preset=)([^&]*)/g,function(t,s,n){return s+e}):t+="&_gsf_preset="+e,window.history.pushState("","",t)}},e(document).ready(function(){GSF_THEME_OPTION.init()})}(jQuery);