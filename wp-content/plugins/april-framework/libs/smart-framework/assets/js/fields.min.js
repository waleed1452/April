String.prototype.capitalize=function(){return this.replace(/((^|\s)+)(.)/g,function(a,b,c,d){return b+d.toUpperCase()})};var GSF=GSF||{};(function(a){'use strict';var b=a(document);GSF.helper={isCheckBox:function(c){return c.is(':checkbox')},isRadio:function(c){return c.is(':radio')},isText:function(c){return(c.is('input')||c.is('textarea'))&&!this.isCheckBox(c)&&!this.isRadio(c)},isSelect:function(c){return c.is('select')},changeCloneNameIndex:function(c,d,e,f,g,h,k,l){var n=0<c.closest('.widget-content').length,o='';return n&&(o=d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t){return q+r+s+t}),d=d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u,v,w,x){return v+x})),d=e&&f?0<=g?0<=h?l?d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G){return q+r+g+t+u+v+w+x+h+z+A+B+C+D+k+F+G}):d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u,v,w,x,y,z,A){return q+r+g+t+u+v+w+x+h+z+A}):l?d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u,v,w,x,y,z,A,B,C,D){return q+r+g+t+u+v+w+x+y+z+A+k+C+D}):d.replace(/^([^\[]+)(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u){return q+r+k+t+u}):0<=h?l?d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u,v,w,x,y,z,A,B,C,D){return q+r+s+t+u+h+w+x+y+z+A+k+C+D}):d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u,v,w,x){return q+r+s+t+u+k+w+x}):d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u,v,w,x,y,z,A){return q+r+s+t+u+v+w+x+k+z+A}):e||f?0<=g?l?d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u,v,w,x,y,z,A){return q+r+g+t+u+v+w+x+k+z+A}):d.replace(/^([^\[]+)(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u){return q+r+k+t+u}):0<=h?l?d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u,v,w,x,y,z,A){return q+r+h+t+u+v+w+x+k+z+A}):d.replace(/^([^\[]+)(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u){return q+r+k+t+u}):d.replace(/^([^\[]+)(\[)([^\]]+)(\])(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u,v,w,x){return q+r+s+t+u+k+w+x}):d.replace(/^([^\[]+)(\[)([^\]]+)(\])(.*)/g,function(p,q,r,s,t,u){return q+r+k+t+u}),n&&(d=o+'['+d.replace(/^([^\[]+)(\[)(.*)/g,function(p,q,r,s){return q+']'+r+s})),d}},GSF.fields={createFieldObject:function(c,d){if(null==c||''==c)return null;var e='GSF_'+c.capitalize()+'Class';return'undefined'==typeof window[e]?null:new window[e](d)},init:function(){this.timeOutFunc(this.addCloneButtonClick),this.timeOutFunc(this.removeCloneButtonClick),this.timeOutFunc(this.sectionClick),this.timeOutFunc(this.sectionTitleClick),a(document).trigger('gsf_before_init_fields'),a('.gsf-meta-box-wrap').each(function(){var c=a(this);c.closest('#widgets-left').length||GSF.fields.initFields(c)})},timeOutFunc:function(c){setTimeout(c,1)},initFields:function(c){GSF.fields.onChangeFieldControl(c),c.each(function(){GSF.required.processApplyField(this)}),GSF.required.onChange(c),GSF.fields.makeCloneTemplate(c),GSF.fields.sortable(c),GSF.fields.changePanelTitleEvent(c),GSF.fields.initFieldsDetails(c),c.find('.gsf-section-container').first().show(),c.find('.gsf-sections li').first().addClass('active'),GSF.fields.initFieldJs(c.find('.gsf-section-container').first()),c.find('.gsf-meta-box-wrap-loading').addClass('in')},initFieldsDetails:function(c){var d=0==c.find('.gsf-section-container').length||0!=a('.gsf-term-meta-add-new').length;c.find('.gsf-field-content-inner').each(function(){var e=a(this),f=e.closest('.gsf-field'),g=f.data('field-type'),h=GSF.fields.createFieldObject(g,e);if(null!=h){this.fieldJs=h;var k=this.fieldJs;d&&setTimeout(function(){k.init(),k.initDone=!0},1)}})},initFieldJs:function(c){c.find('.gsf-field-content-inner').each(function(){if(null!=this.fieldJs&&null==this.fieldJs.initDone){var d=this;setTimeout(function(){d.fieldJs.init(),d.fieldJs.initDone=!0},1)}})},stickySection:function(c){var d=32,e=a('.gsf-theme-options-action-inner');e.length&&(d+=e.outerHeight()),c.find('.gsf-sections > ul').hcSticky({top:d})},changePanelTitleEvent:function(c){c.find('.gsf-field-panel-inner').each(function(d){var e=a(this),f=e.data('panel-title');e.data('panel-title-text',e.find('.gsf-field-panel-title-text').html()),null!=f&&''!==f&&e.find('#'+f).find('[data-field-control]').on('change',function(){GSF.fields.changePanelTitle(this)}),0<d&&(e.find('.gsf-field-panel-content').hide(),e.closest('.gsf-field-panel-clone-item').addClass('in'))}),GSF.fields.initPanelTitle(c)},initPanelTitle:function(c){c.find('.gsf-field-panel-inner').each(function(){var d=a(this),e=d.data('panel-title');null!=e&&''!==e&&d.find('#'+e).find('[data-field-control]').each(function(){GSF.fields.changePanelTitle(this)})})},changePanelTitle:function(c){var d=a(c),e=d.closest('.gsf-field-panel-inner');''==d.val()?e.find('.gsf-field-panel-title-text').html(e.data('panel-title-text')):e.find('.gsf-field-panel-title-text').html(d.val())},makeCloneTemplate:function(c){c.find('.gsf-field-clone-wrapper').each(function(){var d=a(this),e=d.find('> .gsf-field-clone-item').last();0<e.length&&d.data('clone-template',e[0].outerHTML)})},sectionClick:function(){a(b).on('click','.gsf-sections a',function(c){c.preventDefault();var d=a(this),e=d.attr('href'),f=a(c.target).closest('.gsf-meta-box-wrap'),g=f.find(e);d.closest('ul').find('li').removeClass('active'),d.parent().addClass('active'),f.find('.gsf-section-container').hide(),g.show(),GSF.fields.initFieldJs(g),d.trigger('gsf_section_changed'),f.find(e).find('.gsf-map-canvas').each(function(){'undefined'!=typeof google&&'undefined'!=typeof google.maps&&'undefined'!=typeof google.maps.event&&'undefined'!=typeof google.maps.event.trigger&&google.maps.event.trigger(this,'resize')})})},sectionTitleClick:function(){a(document).on('click','.gsf-section-title',function(){var c=a(this);c.toggleClass('in'),c.next().slideToggle();var d=c.closest('.gsf-section-container');GSF.fields.initFieldJs(d)})},removeCloneButtonClick:function(){b.on('click','.gsf-clone-button-remove',function(){var c=a(this),d=c.closest('.gsf-field-clone-wrapper');c.closest('.gsf-field-clone-item').remove(),GSF.fields.reIndexCloneField(d)})},addCloneButtonClick:function(){b.on('click','.gsf-clone-button-add',function(){var c=a(this),d=c.parent().find('> .gsf-field-clone-wrapper'),e=a(d.data('clone-template'));GSF.fields.changeNameBeforeClone(e),d.append(e),GSF.fields.reIndexCloneField(d),GSF.fields.restoreNameAfterClone(e),GSF.fields.initFields(e),GSF.fields.onChangeFieldControl(e),GSF.required.onChange(e),e.trigger('gsf_add_clone_field'),e.find('.gsf-field').trigger('gsf_check_required')})},changeNameBeforeClone:function(c){c.find('[data-field-control]').each(function(){var d=a(this),e=d.attr('name');null!=e&&0!==e.indexOf('____')&&d.attr('name','____'+e)})},restoreNameAfterClone:function(c){c.find('[data-field-control]').each(function(){var d=a(this),e=d.attr('name');null!=e&&0===e.indexOf('____')&&(e=e.substring(4),d.attr('name',e))})},onChangeFieldControl:function(c){c.find('[data-field-control]').on('change',function(){a(this).trigger('gsf_field_control_changed')}).on('gsf_field_control_changed',function(){var d=a(this);if(d.data('field-no-change'))return void d.data('field-no-change',!1);if(!d.data('field-set-value')){var e=d.closest('.gsf-field'),f=GSF.fields.getValue(e);e.data('field-value',f),e.trigger('gsf_check_required'),e.trigger('gsf_check_preset'),e.trigger('gsf_field_change')}})},reIndexCloneField:function(c){c.find('> .gsf-field-clone-item').each(function(d){var e=a(this);e.data('clone-index',d),e.find('[data-field-control]').each(function(){var f=a(this),g=f.attr('name');if(null!=g||''!==g){var h=f.closest('.gsf-field').find('.gsf-field-clone-item').length,k=f.closest('.gsf-field-repeater-clone-item'),l=k.data('clone-index');(null==l||''===l)&&(l=-1);var n=f.closest('.gsf-field-panel-clone-item'),o=n.data('clone-index');(null==o||''===o)&&(o=-1);var p=0<f.closest('.gsf-field-panel').length,q=0<f.closest('.gsf-field-repeater').length;g=GSF.helper.changeCloneNameIndex(f,g,p,q,o,l,d,h),f.attr('name',g)}})})},sortable:function(c){c.find('.gsf-field-clone-wrapper').sortable({items:'.gsf-field-clone-item',placeholder:'gsf-field-clone-sortable-placeholder',handle:'.gsf-sortable-button,.gsf-field-panel-title.gsf-field-panel-title-sortable',cancel:'.gsf-clone-button-remove,.gsf-field-panel-title-toggle',update:function(d){var f=a(d.target);GSF.fields.reIndexCloneField(f)},stop:function(d,e){var f=e.item.find('textarea.wp-editor-area');f.each(function(g,h){var k,l;if(k=tinyMCE.EditorManager.get(h.id),l=a(this).parents('.tmce-active').length,k&&l){a(this).parent().find(' > .mce-container').remove(),a('#'+h.id).val(k.getContent()),a('#'+h.id).show();var n=tinyMCEPreInit.mceInit[h.id];tinymce.init(n)}})}})},clearFieldValue:function(c){c.find('[data-field-control]').each(function(){var d=a(this),e=d.closest('.gsf-field');e.data('field-value',''),GSF.helper.isSelect(d)?d.prop('selectedIndex',0):GSF.helper.isCheckBox(d)||GSF.helper.isRadio(d)?d.prop('checked',!1):d.val('')})},getValue:function(c){var d='';if(0<c.find('.gsf-field-clone-item').length)d=[],c.find('.gsf-field-clone-item').each(function(){var f=a(this).find('> .gsf-field-content-inner');d.push(null==f[0].fieldJs?'':f[0].fieldJs.getValue())});else{var e=c.find('.gsf-field-content-inner');e.length&&null!=e[0].fieldJs&&(d=e[0].fieldJs.getValue())}return d}},GSF.group={init:function(){this.toggleGroup()},toggleGroup:function(){b.on('click','.gsf-field-group-title',function(c){var d=a(c.target),e=d.closest('.gsf-field-group');e.toggleClass('in'),e.find('> .gsf-field-group-content').slideToggle()})}},GSF.panel={init:function(){this.togglePanel()},togglePanel:function(){b.on('click','.gsf-field-panel-title',function(c){var d=a(c.target),e=d.closest('.gsf-field-panel-clone-item');if(!d.closest('.gsf-clone-button-remove').length)if(d.closest('.gsf-field-panel-clone').find('.gsf-field-panel-clone-item').each(function(){(0==e.length||this!=e[0])&&(a(this).find('.gsf-field-panel-content').slideUp(),a(this).addClass('in'))}),e.length)e.toggleClass('in'),e.find('.gsf-field-panel-content').slideToggle();else{var f=d.closest('.gsf-field-panel');f.toggleClass('in'),f.find('.gsf-field-panel-content').slideToggle()}})},sortable:function(){}},GSF.required={processApplyField:function(c){var d=[];a(c).find('.gsf-field[data-required]').each(function(){var h,k,l,n,o,p,q,e=a(this),f=e.data('required'),g=e.attr('id');if(a.isArray(f[0])){for(h=0;h<f.length;h++)if(l=f[h],a.isArray(l[0]))for(k=0;k<l.length;k++)n=l[k],o=n[0],p=n[1],q=n[2],-1!=o.indexOf('[')&&(o=o.replace(/\[.*/i,'')),'undefined'==typeof d[o]&&(d[o]=[]),-1===d[o].indexOf(g)&&d[o].push(g),'&'===p[0]&&('undefined'==typeof d[q]&&(d[q]=[]),-1===d[q].indexOf(g)&&d[q].push(g));else o=l[0],p=l[1],q=l[2],-1!=o.indexOf('[')&&(o=o.replace(/\[.*/i,'')),'undefined'==typeof d[o]&&(d[o]=[]),-1===d[o].indexOf(g)&&d[o].push(g),'&'===p[0]&&('undefined'==typeof d[q]&&(d[q]=[]),-1===d[q].indexOf(g)&&d[q].push(g));}else o=f[0],p=f[1],q=f[2],-1!=o.indexOf('[')&&(o=o.replace(/\[.*/i,'')),'undefined'==typeof d[o]&&(d[o]=[]),-1===d[o].indexOf(g)&&d[o].push(g),'&'===p[0]&&('undefined'==typeof d[q]&&(d[q]=[]),-1===d[q].indexOf(g)&&d[q].push(g))}),c.applyFieldRequired=d},onChange:function(c){c.find('.gsf-field').on('gsf_check_required',GSF.required.onChangeEvent)},onChangeEvent:function(c){if(this==c.target){var d=a(this),e=d.closest('.gsf-meta-box-wrap'),f=e[0].applyFieldRequired,g=d.attr('id'),h=d.closest('.gsf-field-panel-inner');if(null!=f&&'undefined'!=typeof d.data('field-value')&&'undefined'!=typeof f[g])for(var k=0;k<f[g].length;k++)h.length?GSF.required.toggleField(h.find('[id="'+f[g][k]+'"]'),h,e):GSF.required.toggleField(e.find('[id="'+f[g][k]+'"]'),h,e)}},toggleField:function(c,d,e){var f=c.data('required'),g=!0;g=a.isArray(f[0])?GSF.required.andCondition(f,d,e):GSF.required.processField(f,d,e),g?c.slideDown():c.slideUp()},andCondition:function(c,d,e){var f,g;for(g=0;g<c.length;g++)if(f=c[g],!a.isArray(f[0])){if(!GSF.required.processField(f,d,e))return!1;}else if(!GSF.required.orCondition(f,d,e))return!1;return!0},orCondition:function(c,d,e){var f,g;for(g=0;g<c.length;g++)if(f=c[g],GSF.required.processField(f,d,e))return!0;return!1},processField:function(c,d,e){var k,f=c[0],g=c[1],h=c[2],l='';if(-1!=f.indexOf('[')){var n=f.replace(/\[.*/i,'');l=f.substring(n.length),l=l.substr(1,l.length-2),f=n}return k=d.length?d.find('[id="'+f+'"]').data('field-value'):e.find('[id="'+f+'"]').data('field-value'),''!==l&&'undefined'!=typeof k[l]&&(k=k[l]),'&'===g.substr(0,1)&&(d.length?h=d.find('#'+h).data('field-value'):h=a('#'+h).data('field-value')),'='===g||'&='===g?h==k:'!='===g||'&!='===g?h!=k:'in'===g||'&in'===g?h==k||a.isArray(h)&&-1!=h.indexOf(k):'not in'===g||'&not in'===g?!a.isArray(h)&&h!=k||-1==h.indexOf(k):'contain'===g||'&contain'===g?h==k||a.isArray(k)&&-1!=k.indexOf(h)||'object'==typeof k&&null!=k&&h in k:('not contain'===g||'&not contain'===g)&&(!a.isArray(k)&&k!=h||null==k||-1==k.indexOf(h))}},GSF.preset={init:function(){this.onCheckPreset()},onCheckPreset:function(){a(document).on('gsf_check_preset','.gsf-field',function(c){if(this==c.target){var d=a(this),e=d.closest('.gsf-field-panel-inner');if(0===e.length&&(e=a('.gsf-meta-box-wrap')),'undefined'!=typeof d.data('field-value')){var f=d.data('preset');if('undefined'!=typeof f){var h,k,l,n,o,g=d.data('field-value');for(h=0;h<f.length;h++)if(l=f[h].op,n=f[h].value,o=f[h].fields,'='===l&&n==g||'!='===l&&n!=g){for(k=0;k<o.length;k++){var p=e.find('#'+o[k][0]),q=p.find('[data-field-control]');if(0<p.length&&p[0]!=this)if('object'==typeof o[k][1])for(var r in o[k][1])p.find('[name$="['+r+']"]').val(o[k][1][r]);else GSF.helper.isRadio(q)||GSF.helper.isCheckBox(q)?p.find('[data-field-control][value="'+o[k][1]+'"]').prop('checked',!0):q.val(o[k][1]);q.trigger('gsf_preset_change',o[k][1]),q.trigger('change')}break}}}}})}},GSF.onReady={init:function(){GSF.fields.init(),GSF.group.init(),GSF.panel.init(),GSF.preset.init(),a('.gsf-field').trigger('gsf_check_required')}},GSF.onResize={init:function(){}},b.ready(GSF.onReady.init),a(window).resize(GSF.onResize.init)})(jQuery);